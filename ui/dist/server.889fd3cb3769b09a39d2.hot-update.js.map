{"version":3,"sources":["webpack:///./src/SignInNavItem.jsx"],"names":["SignInNavItem","React","Component","constructor","props","state","showing","disabledGoogleAuth","showModal","bind","hideModal","signOut","signIn","componentDidMount","clientId","window","ENV","GOOGLE_CLIENT_ID","gapi","load","auth2","getAuthInstance","init","client_id","then","setState","loadData","showError","apiEndpoint","UI_AUTH_ENDPOINT","fetch","method","credentials","onUserChange","signedIn","givenName","error","googleToken","googleUser","getAuthResponse","id_token","response","headers","body","JSON","stringify","google_token","text","result","parse","picture","user","render","withToast"],"mappings":"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","file":"server.889fd3cb3769b09a39d2.hot-update.js","sourcesContent":["import React from 'react';\nimport {\n\tNavItem,\n\tModal,\n\tButton,\n\tNavDropdown,\n\tMenuItem,\n\tImage,\n\tGlyphicon\n} from 'react-bootstrap';\n\nimport withToast from './withToast.jsx';\nimport UserContext from './UserContext.js';\n\nclass SignInNavItem extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tshowing: false,\n\t\t\tdisabledGoogleAuth: true\n\t\t};\n\t\tthis.showModal = this.showModal.bind(this);\n\t\tthis.hideModal = this.hideModal.bind(this);\n\t\tthis.signOut = this.signOut.bind(this);\n\t\tthis.signIn = this.signIn.bind(this);\n\t}\n\n\tasync componentDidMount() {\n\t\t// load the Google API Library\n\t\tconst clientId = window.ENV.GOOGLE_CLIENT_ID;\n\t\tif (!clientId) return;\n\t\twindow.gapi.load('auth2', () => {\n\t\t\tif (!window.gapi.auth2.getAuthInstance()) {\n\t\t\t\twindow.gapi.auth2.init({ client_id: clientId }).then(() => {\n\t\t\t\t\tthis.setState({ disabledGoogleAuth: false });\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tawait this.loadData();\n\t}\n\n\tshowModal() {\n\t\t// initial attempt to retrieve the Google Client ID\n\t\tconst clientId = window.ENV.GOOGLE_CLIENT_ID;\n\t\tconst { showError } = this.props;\n\t\tif (!clientId) {\n\t\t\tshowError('Missing environment variable GOOGLE_CLIENT_ID');\n\t\t\treturn;\n\t\t}\n\t\tthis.setState({ showing: true });\n\t}\n\n\thideModal() {\n\t\tthis.setState({ showing: false });\n\t}\n\n\tasync signOut() {\n\t\tconst apiEndpoint = window.ENV.UI_AUTH_ENDPOINT;\n\t\tconst { showError } = this.props;\n\t\ttry {\n\t\t\t// API call to clear cookie on the back-end server\n\t\t\tawait fetch(`${apiEndpoint}/signout`, {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tcredentials: 'include'\n\t\t\t});\n\t\t\t// sign out of the Google Authentication session\n\t\t\tconst auth2 = window.gapi.auth2.getAuthInstance();\n\t\t\tawait auth2.signOut();\n\n\t\t\t// call back from Page.jsx, so that it can update its state and context value, and re-renders the page\n\t\t\tconst { onUserChange } = this.props;\n\t\t\tonUserChange({ signedIn: false, givenName: '' });\n\t\t} catch (error) {\n\t\t\tshowError(`Error signing out: ${error}`);\n\t\t}\n\t}\n\n\tasync signIn() {\n\t\tthis.hideModal();\n\t\tconst { showError } = this.props;\n\t\tlet googleToken;\n\t\t// we use Google API's Authentication library to retrieve the token\n\t\ttry {\n\t\t\tconst auth2 = window.gapi.auth2.getAuthInstance();\n\t\t\tconst googleUser = await auth2.signIn();\n\t\t\tgoogleToken = googleUser.getAuthResponse().id_token;\n\t\t} catch (error) {\n\t\t\tshowError(`Error authenticating with Google: ${error.error}`);\n\t\t}\n\n\t\t// send the token to our back-end Authentication API so that it can be verified\n\t\ttry {\n\t\t\tconst apiEndpoint = window.ENV.UI_AUTH_ENDPOINT;\n\t\t\tconst response = await fetch(`${apiEndpoint}/signin`, {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tcredentials: 'include',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify({ google_token: googleToken })\n\t\t\t});\n\t\t\tconst body = await response.text();\n\t\t\tconst result = JSON.parse(body);\n\t\t\tconst { signedIn, givenName, picture } = result;\n\n\t\t\t// call back from Page.jsx, so that it can update its state and context value, and re-renders the page\n\t\t\tconst { onUserChange } = this.props;\n\t\t\tonUserChange({ signedIn, givenName });\n\t\t} catch (error) {\n\t\t\tshowError(`Error signing into the app: ${error}`);\n\t\t}\n\t}\n\n\t// called on browser refresh to retrieve credentials from back-end persistent session\n\tasync loadData() {\n\t\tconst apiEndpoint = window.ENV.UI_AUTH_ENDPOINT;\n\t\tconst response = await fetch(`${apiEndpoint}/user`, {\n\t\t\tmethod: 'POST'\n\t\t});\n\t\tconst body = await response.text();\n\t\tconst result = JSON.parse(body);\n\t\tconst { signedIn, givenName, picture } = result;\n\t\tthis.setState({ user: { signedIn, givenName, picture } });\n\t}\n\n\trender() {\n\t\tconst { user } = this.props;\n\t\t// const picture = (\n\t\t// \t<Image src={user.picture} responsive circle id=\"profile_pic\" />\n\t\t// );\n\t\tif (user.signedIn) {\n\t\t\treturn (\n\t\t\t\t<NavDropdown title={user.givenName} id=\"user\">\n\t\t\t\t\t<MenuItem onClick={this.signOut}>Sign Out</MenuItem>\n\t\t\t\t</NavDropdown>\n\t\t\t);\n\t\t}\n\n\t\tconst { showing, disabledGoogleAuth } = this.state;\n\t\treturn (\n\t\t\t<React.Fragment>\n\t\t\t\t<NavItem onClick={this.showModal}>Sign In</NavItem>\n\t\t\t\t<Modal keyboard show={showing} onHide={this.hideModal} bsSize=\"sm\">\n\t\t\t\t\t<Modal.Header closeButton>\n\t\t\t\t\t\t<Modal.Title>Sign In</Modal.Title>\n\t\t\t\t\t</Modal.Header>\n\t\t\t\t\t<Modal.Body>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tblock\n\t\t\t\t\t\t\tdisabled={disabledGoogleAuth}\n\t\t\t\t\t\t\tbsStyle=\"primary\"\n\t\t\t\t\t\t\tonClick={this.signIn}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tsrc=\"https://developers.google.com/identity/images/btn_google_signin_dark_normal_web.png\"\n\t\t\t\t\t\t\t\talt=\"Sign in with Google\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</Modal.Body>\n\t\t\t\t\t<Modal.Footer>\n\t\t\t\t\t\t<Button bsStyle=\"link\" onClick={this.hideModal}>\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</Modal.Footer>\n\t\t\t\t</Modal>\n\t\t\t</React.Fragment>\n\t\t);\n\t}\n}\n\nexport default withToast(SignInNavItem);\n"],"sourceRoot":""}