{"version":3,"sources":["webpack:///./src/SignInNavItem.jsx"],"names":["SignInNavItem","React","Component","constructor","props","state","showing","disabledGoogleAuth","user","signedIn","givenName","showModal","bind","hideModal","signOut","signIn","componentDidMount","clientId","window","ENV","GOOGLE_CLIENT_ID","gapi","load","auth2","getAuthInstance","init","client_id","then","setState","loadData","showError","googleToken","googleUser","getAuthResponse","id_token","error","apiEndpoint","UI_AUTH_ENDPOINT","response","fetch","method","headers","body","JSON","stringify","google_token","text","result","parse","render","withToast"],"mappings":"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","file":"server.6457466994288d09d5cc.hot-update.js","sourcesContent":["import React from 'react';\nimport { NavItem, Modal, Button, NavDropdown, MenuItem } from 'react-bootstrap';\n\nimport withToast from './withToast.jsx';\n\nclass SignInNavItem extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tshowing: false,\n\t\t\tdisabledGoogleAuth: true,\n\t\t\tuser: { signedIn: false, givenName: ' ' }\n\t\t};\n\t\tthis.showModal = this.showModal.bind(this);\n\t\tthis.hideModal = this.hideModal.bind(this);\n\t\tthis.signOut = this.signOut.bind(this);\n\t\tthis.signIn = this.signIn.bind(this);\n\t}\n\n\tasync componentDidMount() {\n\t\t// load the Google API Library\n\t\tconst clientId = window.ENV.GOOGLE_CLIENT_ID;\n\t\tif (!clientId) return;\n\t\twindow.gapi.load('auth2', () => {\n\t\t\tif (!window.gapi.auth2.getAuthInstance()) {\n\t\t\t\twindow.gapi.auth2.init({ client_id: clientId }).then(() => {\n\t\t\t\t\tthis.setState({ disabledGoogleAuth: false });\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tawait this.loadData();\n\t}\n\n\tshowModal() {\n\t\t// initial attempt to retrieve the Google Client ID\n\t\tconst clientId = window.ENV.GOOGLE_CLIENT_ID;\n\t\tconst { showError } = this.props;\n\t\tif (!clientId) {\n\t\t\tshowError('Missing environment variable GOOGLE_CLIENT_ID');\n\t\t\treturn;\n\t\t}\n\t\tthis.setState({ showing: true });\n\t}\n\n\thideModal() {\n\t\tthis.setState({ showing: false });\n\t}\n\n\tsignOut() {\n\t\tthis.setState({ user: { signedIn: false, givenName: '' } });\n\t}\n\n\tasync signIn() {\n\t\tthis.hideModal();\n\t\tconst { showError } = this.props;\n\t\tlet googleToken;\n\t\t// we use Google API's Authentication library to retrieve the token\n\t\ttry {\n\t\t\tconst auth2 = window.gapi.auth2.getAuthInstance();\n\t\t\tconst googleUser = await auth2.signIn();\n\t\t\tgoogleToken = googleUser.getAuthResponse().id_token;\n\t\t} catch (error) {\n\t\t\tshowError(`Error authenticating with Google: ${error.error}`);\n\t\t}\n\n\t\t// send the token to our back-end Authentication API so that it can be verified\n\t\ttry {\n\t\t\tconst apiEndpoint = window.ENV.UI_AUTH_ENDPOINT;\n\t\t\tconst response = await fetch(`${apiEndpoint}/signin`, {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify({ google_token: googleToken })\n\t\t\t});\n\t\t\tconst body = await response.text();\n\t\t\tconst result = JSON.parse(body);\n\t\t\tconst { signedIn, givenName } = result;\n\t\t\tthis.setState({ user: { signedIn, givenName } });\n\t\t} catch (error) {\n\t\t\tshowError(`Error signing into the app: ${error}`);\n\t\t}\n\t}\n\n\t// called on browser refresh to retrieve credentials from back-end persistent session\n\tasync loadData() {\n\t\tconst apiEndpoint = window.ENV.UI_AUTH_ENDPOINT;\n\t\tconst response = await fetch(`${apiEndpoint}/user`, {\n\t\t\tmethod: 'POST'\n\t\t});\n\t\tconst body = await response.text();\n\t\tconst result = JSON.parse(body);\n\t\tconst { signedIn, givenName } = result;\n\t\tthis.setState({ user: { signedIn, givenName } });\n\t}\n\n\trender() {\n\t\tconst { user, disabledGoogleAuth } = this.state;\n\t\tif (user.signedIn) {\n\t\t\treturn (\n\t\t\t\t<NavDropdown title={user.givenName} id=\"user\">\n\t\t\t\t\t<MenuItem onClick={this.signOut}>Sign Out</MenuItem>\n\t\t\t\t</NavDropdown>\n\t\t\t);\n\t\t}\n\n\t\tconst { showing } = this.state;\n\t\treturn (\n\t\t\t<React.Fragment>\n\t\t\t\t<NavItem onClick={this.showModal}>Sign In</NavItem>\n\t\t\t\t<Modal keyboard show={showing} onHide={this.hideModal} bsSize=\"sm\">\n\t\t\t\t\t<Modal.Header closeButton>\n\t\t\t\t\t\t<Modal.Title>Sign In</Modal.Title>\n\t\t\t\t\t</Modal.Header>\n\t\t\t\t\t<Modal.Body>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tblock\n\t\t\t\t\t\t\tdisabled={disabledGoogleAuth}\n\t\t\t\t\t\t\tbsStyle=\"primary\"\n\t\t\t\t\t\t\tonClick={this.signIn}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<img src=\"https://goo.gl/4yjp6B\" alt=\"Sign In\" />\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</Modal.Body>\n\t\t\t\t\t<Modal.Footer>\n\t\t\t\t\t\t<Button bsStyle=\"link\" onClick={this.hideModal}>\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</Modal.Footer>\n\t\t\t\t</Modal>\n\t\t\t</React.Fragment>\n\t\t);\n\t}\n}\n\nexport default withToast(SignInNavItem);\n"],"sourceRoot":""}